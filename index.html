<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Media Canvas</title>
  <script src="./src/MediaCanvas.js"></script>
	<script src="./src/PresetPasses.js"></script>
</head>

<body>
  <!-- Then manipulate image data and present it here! -->
	<button onclick="killVideo();one()">Tiny Jake</button>
	<button onclick="killVideo();two()">Shitty Jake</button>
	<button onclick="killVideo();three()">Shitty Red Jake</button>
	<button onclick="killVideo();four()">FB Header Image</button>
	<button onclick="killVideo();five();">Video -> Laplance -> Brighter!</button>
  <canvas class="render" style="display:inherit"></canvas>

	<script>

		var MC = new MediaCanvas(document.body.querySelector('.render'));

		// Just render an image! Easy peasy
		function one() {
			MC.setSize(225, 225);
			var img = new Image();
			var src = img;

			src.onload = function() {
				MC.render(src);
			}
			src.src = './jake_tiny.png';
		};


		//Okay, we're getting cray up in here, let's blur this shit
		function two() {
			MC.setSize(550, 550);

			var img = new Image();
			var src = img;

			src.onload = function() {
				MC.render(src);
			}
			src.src = './jake_tiny.png';
		};

		//Okay, we're getting cray up in here, let's blur this shit
		function three() {
			MC.setSize(550, 550);

			var img = new Image();
			var src = img;

			src.onload = function() {
				MC.addPass('redden', new PresetPasses.Redden(100));
				MC.render(src);
				MC.removePass('redden');
			}
			src.src = './jake_tiny.png';
		};

		// A real world application: FB Style Header Image Loading
		// A 1Kb image, replaced by a 3Mb image
		function four() {

			MC.setSize(768, 1024);
			MC.addPass('blur_pass', new PresetPasses.blurStackBox(50));

			var img = new Image();
			var src = img;

			src.onload = function() {
				MC.render(src);
				MC.removePass('blur_pass');

				src.onload = function() {
					MC.render(src);
				};
				src.src = './header-big.jpg';
			}
			src.src = './header-tiny.jpg';


		};

		// Okay, that was fun! Now let's show video
		function five() {
			var video = document.body.querySelector('video') || document.createElement('video');
			video.autoplay = true;
			video.loop = true;

			var src = video;
			src.src = './light-face.webm';

			document.body.appendChild(video);
			video.play();

			MC.setSize(440, 248);

			window.setTimeout(function() {
				MC.addPass('laplace', new PresetPasses.LaplaceConvolution());

				// This is too dark! Let's brighten it!
				window.setTimeout(function(){
					MC.addPass('brighten', new PresetPasses.Brighten(50));
					MC.addPass('contrast', new PresetPasses.Contrast(10));
				}, 1000);

			}, 1000);

			(function render() {

				reqHandle = window.requestAnimationFrame(render);
				MC.render(src);

			})();
		};

		var reqHandle = null;
		function killVideo() {
			if (reqHandle) {
				window.cancelAnimationFrame(reqHandle);
			}
			var vid = document.body.querySelector('video');
			if (!vid) {
				return;
			}

			document.body.removeChild(vid);

			// guard
			MC.removePass('laplace');
			MC.removePass('brighten');
			MC.removePass('contrast');
		}

	</script>

</body>
</html>
